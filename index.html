<!--
[JST 2026-01-03 17:00]  okurigana_fall_game_easy_single.html
送り仮名 × 落ちゲー（簡単版 / 3択タップのみ）
操作:
  - 下の3つの候補ボタンをタップするだけ（スワイプ・移動なし）
ルール:
  - 問題が上から落ちてくる
  - 落ち切る前に正しい送り仮名（かな）をタップ → 正解
  - 間違い or タイムアウト → ライフ-1
-->
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>送り仮名 落ちゲー（簡単）</title>
  <style>
    :root{
      --bg:#0e1326;
      --panel:rgba(255,255,255,0.06);
      --panel2:rgba(255,255,255,0.10);
      --text:rgba(255,255,255,0.92);
      --muted:rgba(255,255,255,0.68);
      --ok:rgba(120,170,255,0.95);
      --ng:rgba(255,90,120,0.95);
      --line:rgba(255,255,255,0.18);
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --radius:16px;
      --btnRadius:18px;
      --shadow: 0 18px 55px rgba(0,0,0,0.35);
    }
    html, body{
      height:100%;
      margin:0;
      background:
        radial-gradient(1000px 600px at 20% 10%, rgba(120,170,255,0.14), transparent 55%),
        radial-gradient(900px 600px at 90% 25%, rgba(255,90,120,0.10), transparent 55%),
        var(--bg);
      color:var(--text);
      font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior: none;
      user-select:none;
    }

    .app{
      height:100%;
      display:grid;
      grid-template-rows: auto 1fr auto;
      gap:10px;
      padding-top: calc(10px + var(--safe-top));
      padding-bottom: calc(10px + var(--safe-bottom));
    }

    /* 上部HUD */
    .hud{
      margin:0 12px;
      padding:12px 12px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--panel2), var(--panel));
      border:1px solid rgba(255,255,255,0.08);
      box-shadow: var(--shadow);
      display:grid;
      grid-template-columns: 1fr auto;
      align-items:center;
      gap:10px;
    }
    .hudLeft .title{
      font-size:15px;
      font-weight:900;
      letter-spacing:0.3px;
      line-height:1.2;
    }
    .hudLeft .sub{
      margin-top:4px;
      font-size:12px;
      color:var(--muted);
      line-height:1.2;
    }
    .hudRight{
      display:grid;
      gap:6px;
      text-align:right;
      font-variant-numeric: tabular-nums;
    }
    .hudRight .row{
      font-size:12px;
      color:var(--muted);
    }
    .hudRight .row b{
      color:var(--text);
      font-size:14px;
      margin-left:8px;
      font-weight:900;
    }

    /* フィールド */
    .field{
      margin:0 12px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.08);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      min-height: 380px;
    }

    /* タイムアウト判定ライン */
    .catchLine{
      position:absolute;
      left:0; right:0;
      height:2px;
      background: rgba(255,255,255,0.10);
      bottom: 112px;
      pointer-events:none;
    }
    .catchLabel{
      position:absolute;
      right:10px;
      bottom: calc(112px + 8px);
      font-size:11px;
      color: var(--muted);
      background: rgba(0,0,0,0.20);
      border:1px solid rgba(255,255,255,0.10);
      padding:4px 8px;
      border-radius:999px;
      pointer-events:none;
    }

    /* 落下する問題カード */
    .falling{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      top: -60px;
      text-align:center;
      pointer-events:none;
      z-index: 5;
    }
    .card{
      display:inline-grid;
      gap:8px;
      padding:14px 12px;
      border-radius:16px;
      background: rgba(0,0,0,0.24);
      border:1px solid rgba(255,255,255,0.14);
      box-shadow: 0 18px 40px rgba(0,0,0,0.28);
    }
    .qText{
      font-size:34px;
      font-weight:900;
      letter-spacing:1px;
      line-height:1.0;
      white-space: nowrap;
    }
    .qHint{
      font-size:12px;
      color:var(--muted);
      letter-spacing:0.2px;
    }

    /* フィードバック */
    .toast{
      position:absolute;
      left:50%;
      top: 14px;
      transform: translateX(-50%);
      padding:10px 14px;
      border-radius:999px;
      background: rgba(0,0,0,0.22);
      border:1px solid rgba(255,255,255,0.12);
      color: var(--text);
      font-size:13px;
      font-weight:900;
      opacity:0;
      pointer-events:none;
      z-index: 10;
    }
    .toast.show{
      opacity:1;
      animation: toastFade 850ms ease-out forwards;
    }
    .toast.ok{
      border-color: rgba(120,170,255,0.35);
      background: rgba(120,170,255,0.14);
    }
    .toast.ng{
      border-color: rgba(255,90,120,0.35);
      background: rgba(255,90,120,0.14);
    }
    @keyframes toastFade{
      0%{ transform: translateX(-50%) translateY(6px); opacity:0; }
      20%{ transform: translateX(-50%) translateY(0px); opacity:1; }
      100%{ transform: translateX(-50%) translateY(-10px); opacity:0; }
    }

    /* 下部: 3択ボタン */
    .choices{
      margin:0 12px;
      padding:12px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--panel2), var(--panel));
      border:1px solid rgba(255,255,255,0.08);
      box-shadow: var(--shadow);
      display:grid;
      gap:10px;
    }
    .choiceRow{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
    }
    .choiceBtn{
      border:none;
      border-radius: var(--btnRadius);
      padding:18px 8px;
      background: rgba(255,255,255,0.10);
      border:1px solid rgba(255,255,255,0.12);
      color: var(--text);
      font-size:26px;
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 14px 30px rgba(0,0,0,0.18);
    }
    .choiceBtn:active{
      transform: translateY(1px);
      filter: brightness(0.98);
    }
    .choiceBtn.disabled{
      opacity: 0.55;
      cursor: default;
    }

    .smallRow{
      display:grid;
      grid-template-columns: 1fr auto auto;
      gap:10px;
      align-items:center;
    }
    .chip{
      font-size:12px;
      color:var(--muted);
      padding:10px 12px;
      border-radius:999px;
      background: rgba(0,0,0,0.18);
      border:1px solid rgba(255,255,255,0.10);
    }
    .miniBtn{
      border:none;
      border-radius:999px;
      padding:10px 12px;
      background: rgba(255,255,255,0.10);
      border:1px solid rgba(255,255,255,0.10);
      color: var(--text);
      font-weight:900;
      cursor:pointer;
    }
    .miniBtn:active{ transform: translateY(1px); }

    /* オーバーレイ */
    .overlay{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      background: rgba(0,0,0,0.45);
      z-index: 20;
    }
    .overlayCard{
      width:min(360px, 88%);
      border-radius:18px;
      padding:18px 16px;
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      border:1px solid rgba(255,255,255,0.14);
      box-shadow: 0 30px 90px rgba(0,0,0,0.55);
      text-align:center;
    }
    .overlayCard .big{
      font-size:18px;
      font-weight:900;
      letter-spacing:0.4px;
      margin-bottom:8px;
    }
    .overlayCard .desc{
      font-size:12px;
      color:var(--muted);
      line-height:1.6;
      margin-bottom:14px;
    }
    .startBtn{
      width:100%;
      border:none;
      border-radius: 16px;
      padding:14px 12px;
      font-size:16px;
      font-weight:900;
      color: var(--text);
      background: linear-gradient(180deg, rgba(120,170,255,0.95), rgba(80,120,255,0.82));
      box-shadow: 0 16px 34px rgba(80,120,255,0.22);
      cursor:pointer;
    }
    .startBtn:active{ transform: translateY(1px); }
  </style>
</head>

<body>
  <div class="app">
    <header class="hud">
      <div class="hudLeft">
        <div class="title">送り仮名 落ちゲー（簡単）</div>
        <div class="sub">落ち切る前に「正しいかな」をタップ</div>
      </div>
      <div class="hudRight">
        <div class="row">SCORE<b id="scoreTxt">0</b></div>
        <div class="row">STREAK<b id="streakTxt">0</b></div>
        <div class="row">LIFE<b id="lifeTxt">3</b></div>
      </div>
    </header>

    <main class="field" id="field">
      <div class="catchLine"></div>
      <div class="catchLabel">ここまでに答える</div>

      <div class="toast" id="toast"></div>

      <div class="falling" id="falling">
        <div class="card">
          <div class="qText" id="qText">　</div>
          <div class="qHint" id="qHint">下の答えをタップ</div>
        </div>
      </div>

      <div class="overlay" id="overlay">
        <div class="overlayCard">
          <div class="big" id="overlayTitle">スタート</div>
          <div class="desc" id="overlayDesc">
            問題が落ち切る前に、下の3択から正しい送り仮名をタップしてください。<br/>
            間違い or 時間切れでライフが減ります。
          </div>
          <button class="startBtn" id="startBtn">開始</button>
        </div>
      </div>
    </main>

    <footer class="choices">
      <div class="choiceRow">
        <button class="choiceBtn" id="c0">-</button>
        <button class="choiceBtn" id="c1">-</button>
        <button class="choiceBtn" id="c2">-</button>
      </div>
      <div class="smallRow">
        <div class="chip" id="statusChip">速度: ゆっくり</div>
        <button class="miniBtn" id="pauseBtn">一時停止</button>
        <button class="miniBtn" id="resetBtn">リセット</button>
      </div>
    </footer>
  </div>

  <script>
    /* 出題（まずは分かりやすいものだけ） */
    var QUESTIONS = [
      { display: "取【】", correct: "る", wrong: ["り","れ"] },
      { display: "見【】る", correct: "み", wrong: ["め","も"] },     // みる
      { display: "書【】く", correct: "か", wrong: ["き","け"] },     // かく
      { display: "読【】む", correct: "よ", wrong: ["ゆ","や"] },     // よむ
      { display: "走【】る", correct: "はし", wrong: ["はす","はさ"] }, // はしる
      { display: "待【】つ", correct: "ま", wrong: ["み","む"] },     // まつ
      { display: "立【】つ", correct: "た", wrong: ["ち","つ"] },     // たつ
      { display: "話【】す", correct: "はな", wrong: ["はね","はの"] }, // はなす
      { display: "洗【】う", correct: "あら", wrong: ["あれ","あろ"] }, // あらう
      { display: "選【】ぶ", correct: "えら", wrong: ["える","えろ"] }  // えらぶ
    ];

    var field = document.getElementById("field");
    var falling = document.getElementById("falling");
    var qText = document.getElementById("qText");

    var c0 = document.getElementById("c0");
    var c1 = document.getElementById("c1");
    var c2 = document.getElementById("c2");
    var btns = [c0, c1, c2];

    var scoreTxt = document.getElementById("scoreTxt");
    var streakTxt = document.getElementById("streakTxt");
    var lifeTxt = document.getElementById("lifeTxt");
    var statusChip = document.getElementById("statusChip");

    var toast = document.getElementById("toast");

    var overlay = document.getElementById("overlay");
    var overlayTitle = document.getElementById("overlayTitle");
    var overlayDesc = document.getElementById("overlayDesc");
    var startBtn = document.getElementById("startBtn");

    var pauseBtn = document.getElementById("pauseBtn");
    var resetBtn = document.getElementById("resetBtn");

    var score = 0;
    var streak = 0;
    var life = 3;

    var running = false;
    var paused = false;
    var answered = false;

    var fallY = -60;
    var catchY = 0;

    // 速度（簡単版は固定でゆっくり）
    var speed = 2.0; // px/frame

    var correct = "";
    var lastFrame = 0;

    function randInt(n){ return Math.floor(Math.random() * n); }

    function shuffle(arr){
      var a = arr.slice();
      for (var i = a.length - 1; i > 0; i--){
        var j = randInt(i + 1);
        var t = a[i]; a[i] = a[j]; a[j] = t;
      }
      return a;
    }

    function showToast(text, ok){
      toast.textContent = text;
      toast.className = "toast " + (ok ? "ok" : "ng") + " show";
      setTimeout(function(){ toast.className = "toast"; }, 880);
    }

    function setButtonsEnabled(on){
      for (var i=0;i<btns.length;i++){
        if (on){
          btns[i].className = "choiceBtn";
          btns[i].disabled = false;
        } else {
          btns[i].className = "choiceBtn disabled";
          btns[i].disabled = true;
        }
      }
    }

    function renderHud(){
      scoreTxt.textContent = String(score);
      streakTxt.textContent = String(streak);
      lifeTxt.textContent = String(life);
      statusChip.textContent = "速度: ゆっくり";
      pauseBtn.textContent = paused ? "再開" : "一時停止";
    }

    function layout(){
      // 判定ライン: bottom 112px → field内のY座標に変換
      // fallingのカードがこのYを超えたらタイムアウト扱い
      var h = field.clientHeight;
      catchY = h - 112 - 40; // ざっくり中央基準（カード高さの半分程度）
    }

    function spawn(){
      var q = QUESTIONS[randInt(QUESTIONS.length)];
      correct = q.correct;

      var opts = shuffle([q.correct, q.wrong[0], q.wrong[1]]);
      qText.textContent = q.display;

      c0.textContent = opts[0];
      c1.textContent = opts[1];
      c2.textContent = opts[2];

      fallY = -60;
      falling.style.top = fallY + "px";

      answered = false;
      setButtonsEnabled(true);
      renderHud();
    }

    function nextAfter(ms){
      setButtonsEnabled(false);
      setTimeout(function(){
        if (!running) return;
        spawn();
      }, ms);
    }

    function judge(tapped){
      if (!running || paused || answered) return;
      answered = true;

      if (tapped === correct){
        streak += 1;
        var gain = 10 + Math.min(20, streak); // 連続でちょい増し
        score += gain;
        showToast("正解 +" + gain, true);
      } else {
        streak = 0;
        life -= 1;
        showToast("不正解 -1", false);
      }

      renderHud();

      if (life <= 0){
        gameOver();
        return;
      }

      nextAfter(420);
    }

    function timeout(){
      if (!running || paused || answered) return;
      answered = true;
      streak = 0;
      life -= 1;
      showToast("時間切れ -1", false);
      renderHud();

      if (life <= 0){
        gameOver();
        return;
      }
      nextAfter(420);
    }

    function loop(ts){
      if (!running) return;
      if (!lastFrame) lastFrame = ts;
      lastFrame = ts;

      if (!paused && !answered){
        fallY += speed;
        falling.style.top = fallY + "px";
        if (fallY >= catchY){
          timeout();
        }
      }
      requestAnimationFrame(loop);
    }

    function start(){
      score = 0;
      streak = 0;
      life = 3;
      paused = false;
      running = true;
      overlay.style.display = "none";
      lastFrame = 0;

      layout();
      spawn();
      requestAnimationFrame(loop);
    }

    function gameOver(){
      running = false;
      paused = false;
      setButtonsEnabled(false);

      overlayTitle.textContent = "ゲームオーバー";
      overlayDesc.innerHTML = "SCORE: <b>" + score + "</b><br/>もう一度やる場合は開始を押してください。";
      startBtn.textContent = "もう一度";
      overlay.style.display = "grid";
    }

    function resetAll(){
      running = false;
      paused = false;
      answered = false;
      setButtonsEnabled(false);

      overlayTitle.textContent = "スタート";
      overlayDesc.innerHTML =
        "問題が落ち切る前に、下の3択から正しい送り仮名をタップしてください。<br/>間違い or 時間切れでライフが減ります。";
      startBtn.textContent = "開始";
      overlay.style.display = "grid";

      qText.textContent = "　";
      c0.textContent = "-"; c1.textContent = "-"; c2.textContent = "-";
      fallY = -60; falling.style.top = fallY + "px";

      score = 0; streak = 0; life = 3;
      renderHud();
    }

    // 入力：3択タップのみ
    c0.addEventListener("click", function(){ judge(c0.textContent); });
    c1.addEventListener("click", function(){ judge(c1.textContent); });
    c2.addEventListener("click", function(){ judge(c2.textContent); });

    pauseBtn.addEventListener("click", function(){
      if (!running) return;
      paused = !paused;
      renderHud();
    });

    resetBtn.addEventListener("click", function(){
      resetAll();
    });

    startBtn.addEventListener("click", function(){
      start();
    });

    window.addEventListener("resize", function(){
      layout();
    });

    // 初期化
    layout();
    setButtonsEnabled(false);
    renderHud();
  </script>
</body>
</html>